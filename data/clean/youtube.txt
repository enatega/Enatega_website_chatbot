# Enatega Development Setup and Deployment Guide

## 1. Initial Development Environment Setup

### 1.1 Node.js and NVM Installation

Ensure Brew is installed on Mac OS by checking the version using `Brew -V`. Use Brew to install NVM (Node Version Manager) with the command `Brew install NVM` and verify installation with `NVM -V`. Install the recommended Node.js version 18.20.4 or any version beyond 18 using `NVM install 18.20.4`.

Use `NVM LS` to list all installed Node.js versions. If multiple versions exist, set the required version as default using `NVM alias default 18.20.4`. The default version will be highlighted in green in the list. Confirm Node.js is working properly by running `Node -V` and executing any simple JavaScript code snippet to verify functionality.

### 1.2 Git and SSH Configuration

Install Git using Brew via the command `Brew install Git` and verify the installation by checking the version with `Git -V`, which should show a version like 2.39 or higher. Generate a new SSH key by following standard git ssh configuration procedures found through a Google search.

During SSH key generation, use an appropriate email address and accept the default path by pressing enter. Enter and reconfirm a passphrase that must be remembered, as it will be required for authentication during project cloning operations.

Start the SSH agent and add the newly generated key to it. Change the directory to `~/.SSH` and create an empty configuration file using the `touch config` command. Open the configuration file with a text editor and paste the SSH configuration from the standard setup article, ensuring the key ID or name is correct to avoid conflicts.

Copy the public key to the clipboard using the command provided in the standard git ssh configuration article. Navigate to your GitHub profile settings, select "SSH and GPG keys", and click "New SSH key". Give the key a meaningful title and select "Authentication Key" from the key type dropdown. Paste the copied public key and click "Add", then confirm by typing your GitHub account password.

### 1.3 Project Cloning

Clone the proprietary Enatega backend API project from GitHub using the SSH link. The cloning process may ask for the passphrase created during SSH key generation. Once cloned, open the project in VS Code using the command `code .`.

## 2. Backend Setup: Backend API

### 2.1 Environment Variables Configuration

Create a new `.env` file in the backend project directory. Paste all required environment variables into this file, including connection string, server URL, backend URL, dashboard URL, and web URL. Ensure the Server URL uses the correct private IP address of your system for proper local network connectivity.

### 2.2 MongoDB Setup and Configuration

Sign in to MongoDB Atlas and create an account if you don't have one. Configure Network Access settings for your cluster. For testing purposes, allow access from any IP address using `0.0.0.0/0`, though this configuration is not recommended for production environments.

Create a database user such as `enatega_test_user` and assign it a password. Assign the user an Admin role or the required role for your configuration. Use the default free cluster named Cluster 0 for your setup. Create a new database with a name like `enatega_test_user` and create a default collection named `user`.

Navigate to the cluster overview and click "Connect". Select "MongoDB for VS Code" to obtain the default connection string. Copy the connection string and update the password field by removing the brackets and inserting your actual password. Update the database name in the connection string to match your created database.

Paste the final valid connection string into the `CONNECTION_STRING` variable in the backend's `.env` file. Optionally, connect to the database using a GUI tool like MongoDB Compass to verify the connection works correctly.

### 2.3 Firebase Service Account Setup

Navigate to the Firebase console and create a new project for your application. Go to Project Settings and select Service Accounts. Choose Node.js as your environment and click "Generate new private key" to download the service account key file.

Open the downloaded service account key file, which contains sensitive authentication information. Copy the entire contents of this JSON file and paste it into the `serviceAccountKey.json` file located in the Enatega API project directory. Ensure this file is never pushed to any public repository as it contains confidential credentials.

### 2.4 Redis Configuration

Add three environment variables to the `.env` file for Redis configuration: Host, Password, and Port. These credentials are configured in the `docker-compose.yaml` file. The container name such as `redis` is used as the host value. The default Redis port is `6379`. The password can be set to `null` if no password is configured for your Redis instance.

### 2.5 Install Dependencies and Start Server

Run `npm install` or `npm i` in the VS Code terminal to install all required packages for the backend. Execute the start command from package.json using `npm run start` to start the backend server. Verify that the server is running and check the accessibility of the GraphQL playground in your browser at the specified server address.

## 3. Backend Deployment on Railway

### 3.1 Local Docker Testing

Download and install Docker Desktop for your operating system. Clean up any existing Docker images or running containers from previous tests. Use the `docker-compose.yaml` file which contains both backend and Redis configurations to deploy locally.

Run the command `docker compose up` to start the Docker containers. This command pulls the Redis image and builds the backend container. Verify the deployed server is accessible by checking localhost on the specified port, typically `localhost:8001`.

### 3.2 Railway Deployment Process

Log into Railway.app and create a new project by importing your code from GitHub. Select "Add Variables" and use the "Raw Editor" to paste all required environment variables from your local `.env` file into Railway's configuration.

Select the correct branch such as main or your designated deployment branch. Create a new domain for API access using port 8001. Set the Start Command to `npm run start` to define how the application should start on Railway.

Click "Deploy" to apply all changes and begin the deployment process. After backend deployment completes, create a new service in the Railway project by clicking "Add" and selecting "Redis" to add a Redis service for notification queues.

Navigate to the deployed Redis service's variables section and copy the `REDIS_HOST`, `REDIS_PASSWORD`, and `REDIS_PORT` values. Return to the backend API variables section and update the corresponding Redis environment variables with the Railway-provided credentials. Deploy the changes to ensure the backend can connect to the deployed Redis service.

Once deployment is successful, copy the public URL from the Railway settings and verify that the API and GraphQL playground are running and accessible.

## 4. Frontend Setup: Web Portals and Configuration

### 4.1 Local Web Portal Setup

Clone the frontend repository using the SSH configuration you set up earlier. The repository may be named something like "food-delivery-multivendor". Navigate to `multivendor-admin/src/configuration/constant.js` and update the `BACKEND_URL` to point to your local backend URL, ensuring the correct private IP address is used.

In the admin directory, run `npm install` to install all dependencies. Start the Admin Portal using `npm run start`. Similarly, navigate to `customer-web/src/configuration/constant.js` and update the local backend URLs with the correct private IP address.

In the customer web directory, run `npm install` and then `npm run start` to launch the Customer Web Portal.

### 4.2 Google Maps API Configuration

In the Google Cloud Console, create a new project for your application. Navigate to APIs & Services and select Library. Enable all required APIs including Geo Coding, Maps JavaScript, Places, Elevation, Static, Geolocation, Distance Matrix, and Maps SDK for Android and iOS.

Obtain the API key from the Google Cloud Console. In the Admin Portal's configuration section, paste the API key into the Google API Key field.

### 4.3 Gmail and Node Mailer Setup

On the Google account that will be used for sending emails, enable 2-Factor Authentication in the account security settings. Navigate to Security settings and search for "App Passwords". Generate a new app password with a custom name like `enatega_test` and save both the app name and generated password.

In the Admin Portal's Node Mailer configuration section, enter the email address, app name, and the generated app password for email functionality.

### 4.4 Stripe Payment Gateway Integration

Log into your Stripe account using a Business profile if setting up for production. Copy the Publishable Key and Secret Key from your account. Paste these keys into the Admin Portal's Stripe configuration fields.

Navigate to Developers section and select Webhooks. Click "Add an endpoint" and use the URL of your Customer Web Portal. Add the required events: `account.updated` and `checkout.session.completed`. Copy the Signing Secret from the webhook details and update the `STRIPE_WEBHOOK_ENDPOINT_SECRET` environment variable in your Railway backend deployment.

### 4.5 PayPal Payment Gateway Integration

Log into PayPal using a Business account, which is recommended for two-way payment processes. Navigate to Apps & Credentials and create a new app. Copy the generated Client ID and Client Secret. Paste these credentials into the Admin Portal's PayPal configuration fields.

### 4.6 Twilio SMS Service Setup

Sign up or log in to a Twilio account. The Twilio console provides your Account SID and Auth Token. Obtain a Twilio phone number, which can be free or purchased depending on your needs.

Paste the Account SID, Auth Token, and Twilio Phone Number into the Admin Portal's Twilio configuration. Update the `TWILIO_ACCOUNT_SID`, `TWILIO_AUTH_TOKEN`, and `TWILIO_PHONE_NUMBER` environment variables in your Railway backend deployment.

### 4.7 Sentry Error Tracking Configuration

Log into Sentry and create three separate projects: one for Node.js/Express backend API, one for React Native for mobile applications, and one for React for web applications. Copy the DSN URL for each project.

In the Admin Portal's Sentry configuration section, use the Node.js DSN for the API Sentry URL, the React DSN for the Web and Admin portals, and the React Native DSN for the Mobile apps.

### 4.8 Cloudinary Media Storage Setup

Log into Cloudinary and navigate to Settings, then Upload section. Edit the preset and set it to Unsigned. Note the Environment ID and Preset Name from your account settings.

Construct the Cloudinary URL by replacing the placeholder in the base URL with your Environment ID. Paste the constructed URL into the Cloudinary URL field in the Admin Portal. Paste the Preset Name into the Cloudinary Key field.

### 4.9 Amplitude Analytics Configuration

Log into Amplitude and set up a new app. Obtain the API key for both Web and React Native applications. In the index.html file of both Admin and Customer web portals, replace any old Amplitude script with the new one provided by Amplitude.

Paste the API keys into the Amplitude configuration section of the Admin Portal for both Web and Mobile apps.

## 5. Frontend Deployment on Netlify

### 5.1 Admin Portal Deployment

Log into Netlify and select "Add new site" followed by "Import an existing project" from GitHub. Specify the Base Directory as `admin`. Set the Build Command to `npm run build`. Set the Publish Directory to the subdirectory `build` inside the admin directory. Click deploy to begin the deployment process.

### 5.2 Customer Web Portal Deployment

Follow the same process as the Admin Portal deployment. Specify the Base Directory as `web`. Set the Build Command to `npm run build`. Set the Publish Directory to the subdirectory `build` inside the web directory.

Once deployed, verify the site displays restaurants fetched from the production database, confirming end-to-end functionality.

## 6. Mobile App Setup with Expo and Google Services

### 6.1 Expo Project Configuration

Sign up or log in to Expo and create a new project with a name like `test_customer_app`. Update the `app.json` file in your mobile app directory with the following details from your Expo project: `owner`, `slug`, `project ID`, and bundle identifier for iOS and package name for Android such as `com.customer.app`.

Update the `GRAPHQL_URL` and `WS_GRAPHQL_URL` in `environment.js` with the local private IP address for local development testing.

### 6.2 Firebase Mobile Services Configuration

Create a new Firebase project and do not uncheck the measurement ID switch box. Register both an iOS app and an Android app in the Firebase project, ensuring the bundle identifier and package name match exactly what you specified in `app.json`, such as `com.customer.app`.

Download the `google-services.json` file from the Android app settings. This file is collective and includes details for all registered mobile clients including Customer, Restaurant, and Rider apps. Paste this file into the mobile app directory, replacing any existing file.

In Firebase Cloud Messaging, generate a VAPID key pair. Paste this key into the Firebase Admin configuration section of the Admin Portal. In Firebase Project Settings under Service Accounts, generate a new private key. Paste the content of this complete JSON object into the app's Google service account file.

### 6.3 Google OAuth Client IDs Creation

In the Google Cloud Console, navigate to APIs & Services and Credentials. Configure the OAuth consent screen by selecting External. After a successful Expo production build, retrieve the SHA-1 and SHA-256 fingerprints from the app's credentials in Expo. The SHA-256 fingerprint is used in Firebase app configuration.

Create four separate OAuth Client IDs in the Google Cloud Console. For Web Application used for both Admin and Customer Portals, enter both local origins like localhost:3000 and production Netlify URLs with their corresponding redirect URLs.

For Android, match the package name from app.json and paste the SHA-1 fingerprint from Expo. For iOS, match the bundle identifier from app.json. Create an additional Web Application ID with `https://auth.expo.io` as the URL, appending your Expo owner name and app slug to the redirect URL.

Paste all four generated Client IDs into the Google Credentials section of the Admin Portal.

### 6.4 Mobile App Development and Building

Log in via the terminal using `eas login`. Configure the build using `eas build:configure`. Build for production Android using `eas build --platform android --profile production` or for iOS simulator development using `eas build --platform ios --profile development`.

Run the app locally using `npm run start`, then select A for Android or I for iOS in the Expo go prompt to open the simulator or emulator. Repeat this process for the Restaurant and Rider apps as needed.